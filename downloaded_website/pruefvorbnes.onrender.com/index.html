<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wilkommen</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background-color: #f0f2f5; /* Soft Grey Background */
      display: flex;
      flex-direction: column; /* Align items vertically */
      justify-content: center;
      align-items: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      position: relative; /* Needed for positioning the logout button */
    }

    .logout-button {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background-color: #d9534f; /* A slightly softer red */
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-weight: bold;
      transition: background-color 0.3s ease, transform 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
    }

    .logout-button:hover {
      background-color: #c9302c; /* Darker red on hover */
      transform: scale(1.05);
    }

    .header {
      text-align: center;
      margin-bottom: 50px;
    }

    .header h1 {
      color: #333;
      font-size: 5em;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 1.2em;
    }

    .container {
      display: flex;
      gap: 30px; /* Reduced gap for a tighter look */
    }

    .button {
      width: 220px;
      height: 70px; /* Adjusted height for a more modern feel */
      background-color: #004a99; /* Deep Blue */
      color: white;
      text-align: center;
      line-height: 70px;
      font-size: 22px;
      font-weight: bold;
      text-decoration: none;
      border-radius: 35px; /* Fully rounded corners */
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .button:hover {
      background-color: #c8102e; /* Vibrant Red on hover */
      transform: translateY(-5px); /* Lift effect on hover */
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>

  <!-- This is the logout button -->
  <a href="/logout" class="logout-button">Abmelden</a>

  <div class="header">
    <h1>Willkommen zu unserem Test</h1>
    <p>Wir freuen uns, Sie hier zu haben.</p>
  </div>

  <div class="container">
    <a href="/index1" class="button">B1</a>
    <a href="/index2" class="button">B2</a>
  </div>

  <script>
let pingTimeout;
let logoutTimer;
let warningTimer;
let countdownTimer;
let lastPing = 0;

const INACTIVITY_LIMIT = 15 * 60 * 1000; // 15 minutes
const WARNING_BEFORE_LOGOUT = 30 * 1000; // 30 seconds
const warningBox = document.getElementById("warningBox");
const countdownEl = document.getElementById("countdown");

function sendPing() {
    const now = Date.now();
    if (now - lastPing < 10000) return; 
    lastPing = now;
    fetch("/ping").catch(() => {});
}

function resetTimers() {
    clearTimeout(pingTimeout);
    clearTimeout(logoutTimer);
    clearTimeout(warningTimer);
    clearInterval(countdownTimer);

    warningBox.style.display = "none"; // ðŸŸ¡ hide warning if active again

    sendPing();
    pingTimeout = setTimeout(sendPing, 60 * 1000);

    // Show warning 30s before logout
    warningTimer = setTimeout(() => {
        let remaining = 30;
        warningBox.style.display = "block";
        countdownEl.textContent = remaining;

        countdownTimer = setInterval(() => {
            remaining--;
            countdownEl.textContent = remaining;
            if (remaining <= 0) {
                clearInterval(countdownTimer);
            }
        }, 1000);
    }, INACTIVITY_LIMIT - WARNING_BEFORE_LOGOUT);

    // Auto logout
    logoutTimer = setTimeout(() => {
        fetch("/logout", { method: "POST" })
          .then(() => window.location.href = "/");
    }, INACTIVITY_LIMIT);
}

// Events
["mousemove", "keydown", "scroll", "click", "touchstart"].forEach(evt => {
    document.addEventListener(evt, resetTimers);
});

window.addEventListener("pageshow", sendPing);
window.addEventListener("beforeunload", sendPing);

resetTimers();
</script>

</body>
</html>